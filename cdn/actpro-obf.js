var ACTPRO={config:{endpoint:null,cleanUrl:!1,cookie_name:"ACTPRO_visitor",cookie_time:1,postback:{network:"ACTPRO",payout:0},offerwall:{trigger:null,required_conversion:2,checkInEvery:15,title:"Your File is Ready!",text:"Complete 2 offers to unlock the download button.",buttonText:"Download Now",buttonClick:null,onComplete:null,showCloseButton:!0}},params:{},setup:function(e={}){const t=(e,i)=>{for(const n in i)"function"==typeof i[n]?e[n]=i[n]:i[n]instanceof Object&&!Array.isArray(i[n])?(e[n]||Object.assign(e,{[n]:{}}),t(e[n],i[n])):e[n]=i[n];return e};t(this.config,e)},process_params:function(){this.params={source:"direct",medium:"direct",zone_id:window.location.host??"direct",cost:0};var e=this.getCookie(this.config.cookie_name);if(e)try{var t=JSON.parse(e);for(var i in t)new URLSearchParams(window.location.search).has(i)&&"click_id"!==i&&"visitor_id"!==i||void 0===t[i]||(this.params[i]=t[i])}catch(e){console.error("Failed to parse cookie data",e)}var n=new URLSearchParams(window.location.search);n.has("source")&&(this.params.source=n.get("source")),n.has("medium")&&(this.params.medium=n.get("medium")),n.has("zone_id")&&(this.params.zone_id=n.get("zone_id")),n.has("cost")&&(this.params.cost=parseFloat(n.get("cost"))||0),n.has("click_id")&&(this.params.click_id=n.get("click_id")),n.has("visitor_id")&&(this.params.visitor_id=n.get("visitor_id"));("direct"!==this.params.source||"direct"!==this.params.medium||"direct"!==this.params.zone_id||0!==this.params.cost||this.params.click_id||this.params.visitor_id)&&this.cookie(this.config.cookie_name,JSON.stringify(this.params),this.config.cookie_time),this.config.cleanUrl&&this.cleanUrl()},update_params:function(){this.cookie(this.config.cookie_name,JSON.stringify(this.params),this.config.cookie_time)},cleanUrl:function(){window.history.replaceState({},document.title,window.location.pathname)},remove_param:function(e){const t=new URL(window.location.href.split("#")[0]);t.searchParams.delete(e);let i=t.toString();const n=window.location.href.split("#")[1];n&&(i+=`#${n}`),window.history.pushState({},"",i)},send_event:function(e){"function"==typeof gtag&&gtag("event",e,{event_name:e})},ajax:function(e){const t=new XMLHttpRequest,i=(e.method||"GET").toUpperCase();let n=e.url;if("GET"===i&&e.data){const t=new URLSearchParams(e.data).toString();n+=(n.includes("?")?"&":"?")+t}if(t.open(i,n,!0),e.headers)for(const[i,n]of Object.entries(e.headers))t.setRequestHeader(i,n);!["POST","PUT","PATCH"].includes(i)||!e.data||e.headers&&e.headers["Content-Type"]||t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onload=function(){if(t.status>=200&&t.status<300){let i;try{i=t.responseText,t.getResponseHeader("Content-Type")?.includes("application/json")&&(i=JSON.parse(i))}catch(e){}e.success&&e.success(i,t.status,t)}else e.error&&e.error(t,t.status,t.statusText);e.complete&&e.complete(t,t.status)},t.onerror=function(){e.error&&e.error(t,t.status,"Network error"),e.complete&&e.complete(t,t.status)};let s=null;["POST","PUT","PATCH"].includes(i)&&e.data&&(s=e.data instanceof FormData||e.data instanceof URLSearchParams||"string"==typeof e.data?e.data:new URLSearchParams(e.data).toString()),t.send(s)},cookie:function(e,t,i,n="/",s=!1){n=n||"/";var o="";if(i=i||1){var a=new Date;a.setTime(a.getTime()+24*i*60*60*1e3),o="; expires="+a.toUTCString()}var r=s?"; domain="+s:"";document.cookie=e+"="+encodeURIComponent(t)+o+"; path="+n+r},getCookie:function(e){for(var t=e+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){var s=i[n].trim();if(0===s.indexOf(t))return decodeURIComponent(s.substring(t.length))}return null},register:function(e){if(this.params.visitor_id)return!1;var t={source:this.params.source,medium:this.params.medium,zone_id:this.params.zone_id,cost:this.params.cost};this.ajax({method:"POST",url:this.config.endpoint+"/register",data:t,success:function(t){"success"===t.status&&t.visitor_id&&(ACTPRO.params.visitor_id=t.visitor_id,ACTPRO.update_params(),e&&e(t))}})},confirm:function(e="Your Confirmation Code",t="Your confirmation code is: "){if(!this.params.visitor_id)return this.popup("Visitor ID not found!","Visitor ID was not found. Please complete the offers and then try again."),!1;var i={visitor_id:this.params.visitor_id,required_conversion:this.config.offerwall.required_conversion};this.ajax({method:"POST",url:this.config.endpoint+"/confirm",data:i,success:function(i){"success"===i.status&&i.visitor_id&&i.code?ACTPRO.popup(e,t+"<b>"+i.code+"</b>"):"error"===i.status&&i.title&&i.message||"invalid"===i.status?ACTPRO.popup(i.title,i.message):ACTPRO.popup("Something went wrong!","please check that you have completed all number of required offers.")},error:function(e,t){ACTPRO.popup("Error: "+e,t)}})},px:function(e){if(this.params.click_id){var t={click_id:this.params.click_id,network:this.config.postback.network,payout:this.config.postback.payout};this.ajax({method:"POST",url:this.config.endpoint+"/px",data:t,success:function(t){("success"===t.status||"error"===t.status&&!1===t.click_id)&&(delete ACTPRO.params.click_id,ACTPRO.remove_param("click_id"),ACTPRO.update_params()),e&&e(t)},error:function(t,i){e&&e({status:"error",message:i})}})}else e&&e({status:"error",message:"click_id is required"})},offerwall:function(){this.params.visitor_id||this.register(),this.config.offerwall.render=!1;const e=document.createElement("div");e.id="actpro-offerwall",e.className="actpro-offerwall-container",e.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background-color: rgba(0,0,0,0.7);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            z-index: 9999;\n        ";const t=document.createElement("div");t.className="bg-white rounded-4 shadow-lg",t.style.cssText="\n            width: 95%;\n            max-width: 600px;\n            max-height: 90vh;\n            display: flex;\n            flex-direction: column;\n            overflow: hidden;\n            position: relative;\n        ",t.setAttribute("data-bs-theme","light"),t.innerHTML=`\n            <div class="p-3 bg-primary bg-gradient offerwall-header">\n                <h3 class="mb-1 fw-bold fs-5 offerwall-title text-light">${this.config.offerwall.title}</h3>\n                <small class="mb-0 offerwall-text text-light">${this.config.offerwall.text}</small>\n                ${this.config.offerwall.showCloseButton?'<button class="actpro-close-btn btn btn-sm position-absolute top-0 end-0 m-2 bg-light text-primary rounded-circle border-0 shadow-sm offerwall-close-btn"><i class="bi bi-x-lg"></i></button>':""}\n            </div>\n            <div class="py-4 px-3 bg-light offerwall-container" style="overflow-y: auto;">\n                <div id="actpro-offers-container">\n                    <div class="d-flex justify-content-center align-items-center py-4">\n                        <div class="spinner-border text-primary" role="status">\n                            <span class="visually-hidden">Loading...</span>\n                        </div>\n                    </div>\n                </div>\n                <div class="alert alert-info">\n                    <i class="bi bi-info-circle me-1"></i> <small>Confirmation may take up to <b>2 minutes</b> to confirm that you completed the offers.</small>\n                </div>\n            </div>\n            <div class="border-top bg-white offerwall-footer" style="height: 100px;padding: 10px 30px;">\n                <div class="d-flex justify-content-center align-items-center mb-2">\n                    <span id="actpro-status-text" class="text-muted">\n                        <span class="spinner-border spinner-border-sm text-primary me-2" role="status"></span>\n                        Checking offers...\n                    </span>\n                </div>\n                <button id="actpro-download-btn" class="btn btn-primary shadow-sm w-100 py-2 fw-bold offerwall-download-btn" disabled onclick="ACTPRO.send_event('offerwall_button_click')">\n                    ${this.config.offerwall.buttonText}\n                </button>\n            </div>\n        `,e.appendChild(t),document.body.appendChild(e),this.config.offerwall.render=!0,document.getElementById("actpro-download-btn").addEventListener("click",(()=>{this.config.offerwall.buttonClick&&this.config.offerwall.buttonClick()})),this.config.offerwall.showCloseButton&&document.querySelector(".actpro-close-btn").addEventListener("click",(()=>{e.remove(),this.config.offerwall.render=!1})),this.loadOffers()},loadOffers:function(){const e=document.getElementById("actpro-offers-container");this.ajax({method:"POST",url:`${this.config.endpoint}/getOffers`,data:{visitor_id:this.params.visitor_id},success:t=>{if("success"===t.status){if(this.renderOffers(t.offers),this.updateStatus(t.total_conversion),t.total_conversion<this.config.offerwall.required_conversion)var i=setInterval((()=>{clearInterval(i),this.config.offerwall.render&&this.loadOffers()}),1e3*this.config.offerwall.checkInEvery)}else if("error"===t.status){if(!1===t.visitor_id){delete this.params.visitor_id,e.innerHTML='\n                            <div class="d-flex justify-content-center align-items-center py-4">\n                                <div class="spinner-border text-primary" role="status">\n                                    <span class="visually-hidden">Loading...</span>\n                                </div>\n                            </div>\n                        ',this.register();var n=setInterval((()=>{clearInterval(n),this.loadOffers()}),1e3)}}else"invalid"===t.status&&e&&(e.innerHTML='\n                            <div class="alert alert-danger text-center">\n                                Failed to load offers. Please try again later.\n                            </div>\n                        ')},error:()=>{e&&(e.innerHTML='\n                        <div class="alert alert-danger text-center">\n                            Failed to load offers. Please try again later.\n                        </div>\n                    ')}})},renderOffers:function(e){const t=document.getElementById("actpro-offers-container");t&&e&&(t.innerHTML=e.length?"":'\n            <div class="alert alert-info text-center">\n                No offers available at this time.\n            </div>\n        ',e.forEach((e=>{const i=document.createElement("div");i.className="card border d-block rounded-3 mb-3 shadow-none "+(e.is_converted?"bg-success bg-opacity-10 border-success border-opacity-50":e.is_clicked?"bg-primary bg-opacity-10 border-primary border-opacity-50":"bg-white"),i.innerHTML=`\n                <div class="card-body p-3">\n                    <div class="d-flex">\n                        <div class="flex-shrink-0 me-3">\n                            <i class="bi ${e.icon||"bi-gift"} fs-4 ${e.is_converted?"text-success":"text-primary"}"></i>\n                        </div>\n                        <div>\n                            <h6 class="mb-1 fw-bold card-title">${e.title}</h6>\n                            <p class="card-text small pb-0 mb-1">${e.description}</p>\n                    ${e.time?`<span class="badge bg-light text-dark me-1 fw-normal"><i class="bi bi-clock me-2"></i>${e.time}</span>`:""}\n                    ${e.category?`<span class="badge bg-light text-dark fw-normal">${e.category}</span>`:""}\n                        </div>\n                    </div>\n\n                    <div class="flex-grow-1">\n                        <hr class="my-2">\n                        <div class="d-flex justify-content-between align-items-center">\n                            <div>\n                                ${e.completed?'<small class="text-muted fs-small"><i class="bi bi-check-circle-fill text-success"></i> '+e.completed+" completed.<small>":""}\n                            </div>\n                            ${e.is_converted?'\n                                <button class="btn btn-success btn-sm rounded-pill px-3" style="font-size:12px;">\n                                    <i class="bi bi-check-circle-fill me-1"></i> Done\n                                </button>\n                            ':`\n                                <a href="${e.tracking_link}" onclick="ACTPRO.send_event('offer_open_click')" class="btn btn-primary btn-sm rounded-pill d-block px-3" target="_blank"><i class="bi bi-box-arrow-up-right me-1"></i> Open</a>\n                            `}\n                        </div>\n                        ${e.is_clicked&&!e.is_converted?'<small class="d-block" style="font-size:12px;">Please complete the offer you started.</small>':""}\n                    </div>\n                </div>\n            `,t.appendChild(i)})))},updateStatus:function(e){const t=this.config.offerwall.required_conversion,i=document.getElementById("actpro-status-text"),n=document.getElementById("actpro-download-btn");i&&(i.innerHTML=e>=t?`\n                <i class="bi bi-check-circle-fill text-success me-2"></i>\n                ${e} Offers completed\n            `:`\n                <span class="spinner-border spinner-border-sm text-primary me-2" role="status"></span>\n                Completed ${e} of ${t} offers\n            `),n&&(n.disabled=e<t),e>=t&&this.config.offerwall.onComplete&&this.config.offerwall.onComplete()},popup:function(e,t){const i=document.createElement("div");i.className="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center",i.style.backgroundColor="rgba(0,0,0,0.5)",i.style.zIndex="9999999";const n=document.createElement("div");n.className=" rounded shadow p-4 position-relative bg-body-tertiary",n.style.maxWidth="500px",n.style.width="90%";const s=document.createElement("button");s.className="btn-close position-absolute top-0 end-0 m-2",s.setAttribute("aria-label","Close");const o=document.createElement("h5");o.className="fw-bold mb-3 text-muted",o.innerHTML=e;const a=document.createElement("div");a.className="mb-3 text-muted",a.innerHTML=t;const r=document.createElement("i");r.className="bi bi-info-circle-fill text-secondary me-2",o.insertBefore(r,o.firstChild),n.appendChild(s),n.appendChild(o),n.appendChild(a),i.appendChild(n),document.body.appendChild(i),s.addEventListener("click",(function(){document.body.removeChild(i)}))},init:function(){if(this.process_params(),this.config.offerwall.trigger){var e=document.querySelector(this.config.offerwall.trigger);e&&e.addEventListener("click",(function(e){e.preventDefault(),ACTPRO.offerwall()}))}}};
